<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Danfoss KBA Search & Viewer</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; background-color: #f8f9fa; }
header { background-color: #002b5c; color: white; padding: 1em; display: flex; justify-content: space-between; align-items: center; }
nav a { color: white; margin-left: 1em; text-decoration: none; cursor: pointer; }
.note-list, .note-metadata, .note-content { background: white; padding: 1em; margin: 1em; border-radius: 5px; }
.note-list a { display: block; margin-bottom: 0.5em; color: #002b5c; text-decoration: none; cursor: pointer; }
input { padding: 0.5em; width: 90%; margin: 1em; }
h1, h2, h3 { color: #002b5c; }
footer { background-color: #e9ecef; text-align: center; padding: 1em; font-size: 0.9em; }
.note-container { display: flex; flex-wrap: wrap; gap: 1em; }
.note-left { flex: 2; min-width: 300px; }
.note-right { flex: 1; min-width: 250px; display: flex; justify-content: center; align-items: center; }
.note-right img { max-width: 100%; max-height: 80vh; border: 1px solid #ccc; border-radius: 5px; }
.full-width { flex: 1 1 100%; }
</style>
</head>
<body>
<header>
  <div class="logo">Danfoss KBA</div>
  <nav>
    <a id="searchNav" href="#">Search</a>
  </nav>
</header>

<main id="container">
  <input type="text" id="searchBox" placeholder="Search KBAs...">
  <div id="results" class="note-list">Loading KBAs...</div>
</main>

<footer>
  <p>&copy; 2025 Danfoss. All rights reserved.</p>
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("âœ… DOM loaded, starting app...");

  const INDEX_URL = `${window.location.origin}/KBA_NOTES/index.json`;
  let notesList = [];

  async function loadIndex() {
    console.log("Fetching index.json from", INDEX_URL);
    try {
      const res = await fetch(INDEX_URL);
      const ids = await res.json();
      console.log("Index data:", ids);
      notesList = [];

      for (let entry of ids) {
        const fileUrl = `${window.location.origin}/KBA_NOTES/${entry.id}.json`;
        try {
          const noteRes = await fetch(fileUrl);
          if (!noteRes.ok) throw new Error(`HTTP error! status: ${noteRes.status}`);
          const noteData = await noteRes.json();
          notesList.push({
            id: entry.id,
            title: noteData.Title || "Untitled KBA"
          });
        } catch (err) {
          console.error(`Error loading ${entry.id}.json`, err);
          notesList.push({ id: entry.id, title: "Untitled KBA" });
        }
      }

      renderList(notesList);
    } catch (err) {
      console.error("Error loading index.json", err);
      document.getElementById("results").innerHTML = "<p>Error loading index.json</p>";
    }
  }

  function renderList(list) {
    const results = document.getElementById("results");
    results.innerHTML = list.map(note => 
      `<a href="#" data-id="${note.id}">${note.id} - ${note.title}</a>`
    ).join("");
  }

  // Event delegation for clicks
  document.getElementById("results").addEventListener("click", e => {
    if (e.target.tagName === "A") {
      e.preventDefault();
      const noteId = e.target.getAttribute("data-id");
      console.log("ðŸ“Œ Clicked note:", noteId);
      loadNote(noteId);
    }
  });

async function loadNote(noteId) {
  const fileUrl = `${window.location.origin}/KBA_NOTES/${noteId}.json`;
  console.log("Fetching:", fileUrl);
  try {
    const response = await fetch(fileUrl);
    console.log("Status:", response.status);
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    const note = await response.json();
    console.log("Fetched note object:", note); // ðŸ‘ˆ This will show exactly what we got
    renderNote(note);
  } catch (error) {
    console.error("Error fetching note:", error);
    document.getElementById('container').innerHTML = `<p>Note not found: ${noteId}</p>`;
  }
}

function renderNote(note) {
  const hasImage = note.Images && note.Images.length > 0;

  document.getElementById('container').innerHTML = `
    <div class="note-container">
      <div class="note-left ${!hasImage ? 'full-width' : ''}">
        <section class="note-metadata">
          <h1>${note.KBA || ''}: ${note.Title || ''}</h1>
          <ul>
            <li><strong>Date:</strong> ${note.Date || ''}</li>
            <li><strong>Environment:</strong> ${note.Environment || ''}</li>
            <li><strong>Action Definition:</strong> ${note["Action Definition"] || ''}</li>
          </ul>
        </section>

        <section class="note-content">
          <h2>Description</h2>
          <p>${note.Description || ''}</p>

          <h2>Symptom</h2>
          <p>${note.Symptom || ''}</p>

          <h2>Reproducing the Issue</h2>
          <ul>
            ${(note["Reproducing the Issue"] || []).map(step => `<li>${step}</li>`).join('')}
          </ul>

          <h2>Cause</h2>
          <p>${note.Cause || ''}</p>

          <h2>Resolution</h2>
          <p>${note.Resolution || ''}</p>

          <h2>Additional Info</h2>
          <ul>
            ${note["Additional Info"] 
              ? Object.entries(note["Additional Info"])
                  .map(([key, value]) => `<li><strong>${key}:</strong> ${value}</li>`)
                  .join('')
              : ''
            }
          </ul>
        </section>

        <div class="note-list">
          <button onclick="showSearch()">Back to Search</button>
        </div>
      </div>

      ${hasImage ? `
      <div class="note-right">
        <img src="${note.Images[0]}" alt="KBA Image">
      </div>` : ''}
    </div>
  `;
}

  function showSearch() {
    console.log("ðŸ”™ Returning to search");
    document.getElementById('container').innerHTML = `
      <input type="text" id="searchBox" placeholder="Search KBAs...">
      <div id="results" class="note-list">Loading KBAs...</div>
    `;
    document.getElementById("searchBox").addEventListener("input", e => {
      const query = e.target.value.toLowerCase();
      const filtered = notesList.filter(note => 
        note.id.includes(query) || note.title.toLowerCase().includes(query)
      );
      renderList(filtered);
    });
    renderList(notesList);
  }

  loadIndex();
});
</script>
</body>
</html>


